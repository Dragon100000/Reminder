<!DOCTYPE html>
<html>
    <head>
        <style>
            body{
                background-color: black;
                -webkit-text-fill-color: rgb(165, 228, 94);
                font-family: cursive;
                position: absolute;
                top: 10%;
                right: 40%;
            }
            
        </style>
    </head>
    <body>
        <p class="text" id="text"></p>
        <audio id="sound" src=""></audio>
        <button onclick="changeBreak">Change break time</button>
        <script>
            const workouts = ['push-ups', 'pull-ups', 'pistol squats on each leg', 'goblet squats', 'jumping-jacks', 'minutes of stretches', 'russian twists with 10 pounds'];
            let breakTime = 30;
            function show() {//gives alert, sets the timestamp, gives notification, runs check
                let reps = Math.floor(Math.random()*19)+2;
                let theWorkout = workouts[Math.floor(Math.random()*6)];
                let message = 'Do ' + reps + ' ' + theWorkout;
                tWorkouts[theWorkout]+=reps;
                //alert('alert');

                if (Notification.permission !== "granted") {
                Notification.requestPermission().then(permission => {

                    if (permission==='granted') {

                        const options = {
                            body: message
                        };
                        const title = breakTime+' minutes have passed'
                        const notification = new Notification(title, options);
                        notification.onclick = function() {
                            window.focus();
                            notification.close();
                        
                        };
                        
                        document.getElementById('text').textContent=message;
                        localStorage.setItem('timestamp', Date.now());
                        setTimeout(show2, 300000);//show2, 300000
                    } else {
                        console.log('declined');
                    };
                });
                };

                const options = {
                    body: message
                };
                const title = breakTime+' minutes have passed';
                const notification = new Notification(title, options);
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                    //window.open("http://localhost:8000/index.html");
                };

                document.getElementById('text').textContent=message;
                localStorage.setItem('timestamp', Date.now());
                setTimeout(show2, 300000);//show2, 300000
            };

            function show2() {
                const notification = new Notification('Ok. You are good to use your computer again.');
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                    //window.open("http://localhost:8000/index.html");
                };
                setTimeout(check, 0);
            }

            function check() {//gets the timestamp(or sets one), finds the difference between now and the last alert, 
                let lastReminder = localStorage.getItem('timestamp');

                if (lastReminder === null) {
                    // If no reminder timestamp exists (first visit), set one
                    localStorage.setItem('timestamp', Date.now());
                };
                
                // Calculate the time difference between now and the last reminder
                let timeDiff = Date.now() - parseInt(lastReminder);
                // Convert milliseconds to minutes
                let minutesPassed = Math.floor(timeDiff / 60000);//60000
                console.log(minutesPassed);
        
                if (minutesPassed >= breakTime) {//every 30 minutes
                    show();
                } else {
                    setTimeout(check, 0);
                }
            }

            // Check the reminder every time the page loads
            window.addEventListener('load', function() {
                setTimeout(show2, 0);//check
            });

            function changeBreak() {
                prompt('How long (in minutes) would you like the break to be?', (answer)=>{
                    breakTime = answer;
                });
            }
        </script>
    </body>
</html>
